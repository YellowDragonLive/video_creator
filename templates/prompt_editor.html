{% extends "base.html" %}
{% block title %}Prompt ç¼–è¾‘å™¨ â€” Seedance Studio{% endblock %}

{% block content %}
<div class="editor-layout">
    <!-- å·¦ä¾§ï¼šäº”è¦ç´ ç¼–è¾‘å™¨ -->
    <div class="editor-panel">
        <div class="panel-header">
            <h1 class="panel-title">ğŸ¬ Prompt ç¼–è¾‘å™¨</h1>
            <div class="panel-actions">
                <button class="btn btn-ghost" id="btn-load-project" title="åŠ è½½é¡¹ç›®">
                    ğŸ“‚ åŠ è½½
                </button>
                <button class="btn btn-primary" id="btn-save-project" title="ä¿å­˜é¡¹ç›®">
                    ğŸ’¾ ä¿å­˜
                </button>
            </div>
        </div>

        <!-- æ¨¡æ¿é€‰æ‹© -->
        <div class="template-bar">
            <span class="template-label">å¿«é€Ÿæ¨¡æ¿ï¼š</span>
            <div class="template-chips" id="template-chips">
                {% for t in templates %}
                <button class="chip" data-template-id="{{ t.id }}">{{ t.name }}</button>
                {% endfor %}
            </div>
        </div>

        <!-- äº”è¦ç´ è¾“å…¥åŒº -->
        <div class="elements-container" id="elements-container">
            <div class="element-card" data-key="subject">
                <div class="element-header">
                    <span class="element-icon">ğŸ‘¤</span>
                    <span class="element-label">è§’è‰²æŒ‡å®š</span>
                </div>
                <textarea class="element-input" id="input-subject"
                    placeholder="æè¿°ä¸»ä½“ï¼šå¤–è²Œç‰¹å¾ã€æœè£…ã€è¡¨æƒ…ã€å§¿æ€ã€‚&#10;ä¾‹ï¼šä¸€ä½ç©¿ç€çº¢è‰²æ±‰æœçš„å¹´è½»å¥³å­ï¼Œé•¿å‘é£˜é€¸ï¼Œçœ¼ç¥æ¸©æŸ”" rows="3"></textarea>
            </div>

            <div class="element-card" data-key="scene">
                <div class="element-header">
                    <span class="element-icon">ğŸï¸</span>
                    <span class="element-label">åœºæ™¯è®¾å®š</span>
                </div>
                <textarea class="element-input" id="input-scene"
                    placeholder="æè¿°ç¯å¢ƒï¼šæ—¶ä»£èƒŒæ™¯ã€åœ°ç‚¹ã€å…‰ç…§æ¡ä»¶ã€‚&#10;ä¾‹ï¼š19ä¸–çºªçš„ä¼¦æ•¦å¤§è¡—ï¼Œé»„æ˜æš–å…‰ï¼Œè¡—é“ä¸¤æ—æœ‰ç»´å¤šåˆ©äºšå¼å»ºç­‘" rows="3"></textarea>
            </div>

            <div class="element-card" data-key="action">
                <div class="element-header">
                    <span class="element-icon">ğŸ­</span>
                    <span class="element-label">åŠ¨ä½œ / å‰§æƒ…</span>
                </div>
                <textarea class="element-input" id="input-action"
                    placeholder="æè¿°è¿åŠ¨åºåˆ—ï¼šä¸»ä½“åŠ¨ä½œã€äº’åŠ¨ã€æ—¶é—´é¡ºåºã€‚&#10;ä¾‹ï¼šå¥¹ç¼“ç¼“è½¬èº«ï¼Œå¾®ç¬‘ç€å‘é•œå¤´èµ°æ¥ï¼Œè£™æ‘†éšé£é£˜åŠ¨" rows="3"></textarea>
            </div>

            <div class="element-card" data-key="camera">
                <div class="element-header">
                    <span class="element-icon">ğŸ¥</span>
                    <span class="element-label">é•œå¤´è¯­è¨€</span>
                </div>
                <textarea class="element-input" id="input-camera"
                    placeholder="æè¿°è¿é•œæ–¹å¼ï¼šæ¨/æ‹‰/æ‘‡/ç§»/ç¯ç»•/è·Ÿéš/å‡é™ã€‚&#10;ä¾‹ï¼šæ…¢æ¨é•œå¤´ï¼Œä»å…¨æ™¯é€æ¸æ¨è¿›åˆ°é¢éƒ¨ç‰¹å†™" rows="3"></textarea>
            </div>

            <div class="element-card" data-key="atmosphere">
                <div class="element-header">
                    <span class="element-icon">ğŸŒˆ</span>
                    <span class="element-label">æ°›å›´ / å£°éŸ³</span>
                </div>
                <textarea class="element-input" id="input-atmosphere"
                    placeholder="æè¿°é£æ ¼ã€è‰²è°ƒã€éŸ³æ•ˆã€‚&#10;ä¾‹ï¼šç”µå½±æ„Ÿï¼Œæš–è‰²è°ƒï¼ŒèƒŒæ™¯æœ‰è½»å¾®è™šåŒ–ï¼ŒæŸ”å’Œçš„é’¢ç´é…ä¹" rows="3"></textarea>
            </div>
        </div>

        <!-- å‚æ•°é¢æ¿ -->
        <div class="params-panel" id="params-panel">
            <div class="params-header">
                <span class="element-icon">âš™ï¸</span>
                <span class="element-label">è§†é¢‘å‚æ•°</span>
            </div>
            <div class="params-grid">
                <div class="param-group">
                    <label class="param-label">ä»»åŠ¡ç±»å‹</label>
                    <select class="param-select" id="param-task-type">
                        {% for t in task_types %}
                        <option value="{{ t.id }}">{{ t.icon }} {{ t.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="param-group">
                    <label class="param-label">æ¨¡å‹</label>
                    <select class="param-select" id="param-model">
                        {% for m in models %}
                        <option value="{{ m.id }}" {% if m.recommended %}selected{% endif %}>
                            {{ m.name }}{% if m.recommended %} â­{% endif %}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="param-group">
                    <label class="param-label">åˆ†è¾¨ç‡</label>
                    <div class="param-chips" id="param-resolution">
                        {% for r in resolutions %}
                        <button class="chip chip-sm {% if r == '720p' %}active{% endif %}" data-value="{{ r }}">{{ r
                            }}</button>
                        {% endfor %}
                    </div>
                </div>
                <div class="param-group">
                    <label class="param-label">å®½é«˜æ¯”</label>
                    <div class="param-chips" id="param-ratio">
                        {% for r in ratios %}
                        <button class="chip chip-sm {% if r == '16:9' %}active{% endif %}" data-value="{{ r }}">{{ r
                            }}</button>
                        {% endfor %}
                    </div>
                </div>
                <div class="param-group">
                    <label class="param-label">æ—¶é•¿: <span id="duration-display">5</span>ç§’</label>
                    <input type="range" class="param-slider" id="param-duration" min="{{ duration_range[0] }}"
                        max="{{ duration_range[1] }}" value="5" step="1">
                </div>
            </div>
        </div>

        <!-- ç´ æå¼•ç”¨åŒº -->
        <div class="ref-panel" id="ref-panel">
            <div class="params-header">
                <span class="element-icon">ğŸ”—</span>
                <span class="element-label">ç´ æå¼•ç”¨</span>
            </div>
            <div class="ref-assets-list" id="ref-assets-list">
                <div class="ref-empty">æš‚æ— å¼•ç”¨ç´ æã€‚å¯å‰å¾€<a href="/assets">ç´ æç®¡ç†</a>ä¸Šä¼ ç´ æåè¿”å›å¼•ç”¨ã€‚</div>
            </div>
            <button class="btn btn-ghost btn-sm" id="btn-add-ref">+ æ·»åŠ ç´ æå¼•ç”¨</button>
        </div>
    </div>

    <!-- å³ä¾§ï¼šå®æ—¶é¢„è§ˆ -->
    <div class="preview-panel">
        <div class="preview-header">
            <h2 class="preview-title">ğŸ“‹ Prompt é¢„è§ˆ</h2>
            <div class="preview-actions">
                <button class="btn btn-ghost btn-sm" id="btn-copy-prompt" title="å¤åˆ¶æ–‡æœ¬">ğŸ“‹ å¤åˆ¶</button>
                <button class="btn btn-accent btn-sm" id="btn-export-json" title="å¯¼å‡º JSON">ğŸ“¥ å¯¼å‡º JSON</button>
            </div>
        </div>

        <!-- Prompt æ–‡æœ¬é¢„è§ˆ -->
        <div class="preview-section">
            <div class="preview-label">åˆæˆ Prompt</div>
            <div class="preview-text" id="preview-text">
                <span class="preview-placeholder">åœ¨å·¦ä¾§å¡«å†™äº”è¦ç´ ï¼Œæ­¤å¤„å°†å®æ—¶æ˜¾ç¤ºåˆæˆçš„ Prompt æ–‡æœ¬...</span>
            </div>
        </div>

        <!-- å‚æ•°æ±‡æ€» -->
        <div class="preview-section">
            <div class="preview-label">å‚æ•°é…ç½®</div>
            <div class="preview-meta" id="preview-meta">
                <div class="meta-item"><span class="meta-key">æ¨¡å‹</span><span class="meta-val" id="meta-model">Seedance
                        2.0</span></div>
                <div class="meta-item"><span class="meta-key">ä»»åŠ¡</span><span class="meta-val" id="meta-task">æ–‡ç”Ÿè§†é¢‘</span>
                </div>
                <div class="meta-item"><span class="meta-key">åˆ†è¾¨ç‡</span><span class="meta-val"
                        id="meta-resolution">720p</span></div>
                <div class="meta-item"><span class="meta-key">å®½é«˜æ¯”</span><span class="meta-val"
                        id="meta-ratio">16:9</span></div>
                <div class="meta-item"><span class="meta-key">æ—¶é•¿</span><span class="meta-val"
                        id="meta-duration">5ç§’</span></div>
            </div>
        </div>

        <!-- API JSON é¢„è§ˆ -->
        <div class="preview-section">
            <div class="preview-label">API Payload</div>
            <pre class="preview-code" id="preview-json">{}</pre>
        </div>

        <!-- å·²ä¿å­˜é¡¹ç›®åˆ—è¡¨ -->
        <div class="preview-section" id="projects-section" style="display:none;">
            <div class="preview-label">å·²ä¿å­˜çš„é¡¹ç›®</div>
            <div class="projects-list" id="projects-list"></div>
        </div>
    </div>
</div>

<!-- ä¿å­˜å¯¹è¯æ¡† -->
<div class="modal-overlay" id="save-modal" style="display:none;">
    <div class="modal">
        <div class="modal-header">
            <h3>ğŸ’¾ ä¿å­˜é¡¹ç›®</h3>
            <button class="btn-close" id="btn-close-save">&times;</button>
        </div>
        <div class="modal-body">
            <label class="param-label">é¡¹ç›®åç§°</label>
            <input type="text" class="modal-input" id="save-project-name" placeholder="è¾“å…¥é¡¹ç›®åç§°...">
        </div>
        <div class="modal-footer">
            <button class="btn btn-ghost" id="btn-cancel-save">å–æ¶ˆ</button>
            <button class="btn btn-primary" id="btn-confirm-save">ä¿å­˜</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/prompt.js') }}"></script>
{% endblock %}